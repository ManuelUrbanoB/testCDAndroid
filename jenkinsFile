pipeline {
   agent any

   stages {
      stage('Checkout') {
        steps {
          git 'https://github.com/Maur9508/testCDAndroid.git'
        }
      }
      
      stage('Clean') {
        steps {
          sh "gradle clean"
        }
      }
      
      stage('Setup Tools') {
         steps {
            withCredentials([file(credentialsId: 'keystore', variable: 'my_private_key')]) {
                sh 'echo $my_private_key > app/keystore.jks'
            }
         }
      }
      
       stage('Upload to Play Store') {
          steps {
            androidApkUpload googleCredentialsId: 'Google play console', apkFilesPattern: '**/*-release.apk', trackName: 'alpha'  
          }
      }
      
      stage('Cleanup Credential') {
          steps {
             sh "rm app/keystore.jks"
          }
         }
   }

}
